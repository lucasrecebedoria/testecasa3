<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="app-header">
    <div class="header-left">
      <img src="assets/logo.png" alt="Logo" class="logo"/>
    </div>
    <div class="header-right">
      <span id="userBadge" class="badge"></span>
      <button id="logoutBtn" class="btn btn-metal" style="display:none;">Logout</button>
    </div>
  </header>

  <!-- LOGIN / REGISTER -->
  <main id="authView" class="view">
    <div class="card">
      <h2>Acesso</h2>
      <div class="tabs">
        <button class="tab active" data-target="#loginPane">Login</button>
        <button class="tab" data-target="#registerPane">Cadastrar novo usuário</button>
      </div>
      <div id="loginPane" class="tab-pane active">
        <form id="loginForm" autocomplete="off">
          <div class="field">
            <label>Matrícula</label>
            <input type="text" id="loginMatricula" placeholder="ex: 6266" required/>
          </div>
          <div class="field">
            <label>Senha</label>
            <input type="password" id="loginSenha" required/>
          </div>
          <button class="btn btn-primary" type="submit">Entrar</button>
          <p class="help">Os acessos são por matrícula e senha (não e-mail).</p>
        </form>
      </div>
      <div id="registerPane" class="tab-pane">
        <form id="registerForm" autocomplete="off">
          <div class="field">
            <label>Matrícula</label>
            <input type="text" id="regMatricula" required/>
          </div>
          <div class="field">
            <label>Nome</label>
            <input type="text" id="regNome" required/>
          </div>
          <div class="field">
            <label>Senha</label>
            <input type="password" id="regSenha" required/>
          </div>
          <button class="btn btn-primary" type="submit">Cadastrar</button>
          <p class="help">Será criado automaticamente em "usuários" no Firestore.</p>
        </form>
      </div>
      <div id="authMsg" class="msg"></div>
    </div>
  </main>

  <!-- APP -->
  <main id="appView" class="view" style="display:none;">
    <div id="appContent" class="app-grid">

      <!-- LADO ESQUERDO: formulário para criar/editar relatório (liberado só a admins) -->
      <section class="card" id="reportEditorCard">
        <h2>Novo Relatório</h2>
        <form id="reportForm" autocomplete="off">
          <div class="field">
            <label>Data do caixa</label>
            <input type="date" id="dataCaixa" required/>
          </div>
          <div class="field">
            <label>Valor Folha (R$)</label>
            <input type="number" step="0.01" id="valorFolha" required/>
          </div>
          <div class="field">
            <label>Valor em Dinheiro (R$)</label>
            <input type="number" step="0.01" id="valorDinheiro" required/>
          </div>
          <div class="field">
            <label>Sobra/Falta (R$)</label>
            <input type="number" step="0.01" id="sobraFalta" required readonly/>
          </div>
          <div class="field">
            <label>Observação</label>
            <textarea id="observacao" rows="3" placeholder="Escreva observações (opcional)"></textarea>
          </div>
          <div class="field">
            <label>Matrícula do Recebedor</label>
            <input type="text" id="matriculaRef" placeholder="ex: 6266" required/>
          </div>
          <div class="actions">
            <button class="btn btn-primary" type="submit">Salvar</button>
            <button class="btn btn-ghost" type="button" id="clearFormBtn">Limpar</button>
          </div>
          <p class="help">Admins podem criar/editar/excluir. Usuários comuns apenas visualizam seus relatórios.</p>
        </form>
      </section>

      <!-- LADO DIREITO: filtros / visão -->
      <section class="card">
        <div id="adminControls" style="display:none;">
          <h2>Visão do Administrador</h2>
          <div class="field">
            <label>Filtrar por Matrícula</label>
            <input type="text" id="adminFiltroMatricula" placeholder="ex: 6266"/>
          </div>
          <div class="field inline">
            <label>Mês (Resumo)</label>
            <input type="month" id="mesResumo"/>
            <button class="btn btn-metal" id="abrirResumoBtn">Resumo do Recebedor</button>
          </div>
        </div>

        <div id="userControls" style="display:none;">
          <h2>Seus Relatórios</h2>
          <p class="help">Exibindo os 15 mais recentes. Antigos ficam minimizados.</p>
        </div>

        <div id="resumoContainer" class="collapse">
          <div class="collapse-header">
            <h3>Resumo do Recebedor (mês selecionado)</h3>
            <button class="btn btn-ghost" id="fecharResumo">Fechar</button>
          </div>
          <div class="resumo-grid">
            <div class="resumo-card">
              <h4>Total em Folha</h4>
              <div id="resumoTotalFolha" class="resumo-value">—</div>
            </div>
            <div class="resumo-card">
              <h4>Diferenças Positivas (Sobra)</h4>
              <div id="resumoSobra" class="resumo-value">—</div>
              <div class="resumo-list" id="listaSobras"></div>
            </div>
            <div class="resumo-card">
              <h4>Diferenças Negativas (Falta)</h4>
              <div id="resumoFalta" class="resumo-value">—</div>
              <div class="resumo-list" id="listaFaltas"></div>
            </div>
          </div>
        </div>

      </section>

    </div>

    <section class="card fullwidth">
      <h2 id="listaTitulo">Relatórios</h2>
      <div id="reportsList" class="reports-list"></div>
    </section>
  </main>

  <footer class="footer">
    desenvolvido por Lucas L Custodio, versão 1.0
  </footer>

  <div id="modalPos" class="modal" style="display:none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Pós conferência</h3>
        <button class="btn btn-ghost" id="fecharModalPos">Fechar</button>
      </div>
      <div class="modal-body">
        <textarea id="posTexto" rows="4" placeholder="Observações do administrador"></textarea>
        <div class="field">
          <label>Anexar imagem</label>
          <input type="file" id="posImagem" accept="image/*"/>
          <div class="actions">
            <button class="btn btn-metal" id="anexarImagemBtn">Anexar imagem</button>
            <button class="btn btn-ghost" id="verImagemBtn">Visualizar imagem anexada</button>
          </div>
          <div id="imagemPreviewWrap" class="img-preview" style="display:none;">
            <img id="imagemPreview" alt="Pré-visualização"/>
            <button class="btn btn-danger" id="excluirImagemBtn" style="display:none;">Excluir imagem</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="salvarPosBtn">Salvar</button>
      </div>
    </div>
  </div>

  <script type="module" src="firebase-config.js"></script>
  <script type="module" src="app.js"></script>
</body>
</html>
